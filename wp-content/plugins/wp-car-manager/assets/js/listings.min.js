jQuery(function(a){var b=a(".wpcm-vehicle-listings");b&&a.each(b,function(a,b){new WPCM_Listings(b)})});var WPCM_Listings=function(a){this.is_updating=!1,this.nonce=jQuery(a).find("#wpcm-listings-nonce").val(),this.filters=jQuery(a).find(".wpcm-vehicle-filters:first"),this.sort=jQuery(a).find("#wpcm-sort:first"),this.listings=jQuery(a).find(".wpcm-vehicle-results-wrapper>.wpcm-vehicle-results:first"),this.per_page=jQuery(a).data("per_page"),this.default_sort=jQuery(a).data("sort"),this.condition=jQuery(a).data("condition"),this.locked_make=0,jQuery(a).data("make_id")&&(this.locked_make=jQuery(a).data("make_id")),this.init_filters(),this.sort.length>0&&this.init_sort(),this.updateModels(),this.load_vehicles()};WPCM_Listings.prototype.init_filters=function(){var a=this;jQuery.each(this.filters.find("select"),function(a,b){jQuery(b).select2({placeholder:jQuery(b).data("placeholder"),width:"resolve"})}),this.filters.find(".wpcm-filter-make select").change(function(){a.updateModels()}),this.filters.find(".wpcm-filter-button input").click(function(){a.load_vehicles()})},WPCM_Listings.prototype.init_sort=function(){var a=this;this.sort.change(function(){a.load_vehicles()})},WPCM_Listings.prototype.updateModels=function(){var a=this.filters.find(".wpcm-filter-make select option:selected").val(),b=this.filters.find(".wpcm-filter-model select");if(a>0){var c={nonce:wpcm.nonce_models,make:a};c[wpcm.ajax_endpoint]="get_models",jQuery.get(wpcm.ajax_url,c,function(a){if(b.attr("disabled",!1).find("option").remove(),void 0!=a&&""!=a&&0!=a&&a.length>0){b.append(jQuery("<option>").val(0).html(b.data("placeholder")));for(var c=0;c<a.length;c++)b.append(jQuery("<option>").val(a[c].id).html(a[c].name))}else b.append(jQuery("<option>").val(0).html(wpcm.lbl_no_models_found));b.select2({width:"resolve"})})}else b.attr("disabled",!0).find("option").remove().end().append(jQuery("<option>").val(0).html(wpcm.lbl_select_make_first)).select2({width:"resolve"})},WPCM_Listings.prototype.load_vehicles=function(){if(1!=this.is_updating){this.is_updating=!0;var a=this,b=this.listings,c={nonce:this.nonce,per_page:this.per_page};jQuery.each(this.filters.find(".wpcm-filter select"),function(a,b){var d=jQuery(b).find("option:selected").val();0!=d&&(c["filter_"+jQuery(b).attr("name")]=d)}),this.locked_make>0&&(c.filter_make=this.locked_make),this.sort.length>0?c.sort=this.sort.find("option:selected").val():c.sort=this.default_sort,""!=this.condition&&(c.filter_condition=this.condition),c[wpcm.ajax_endpoint]="get_vehicle_results",this.listings.parent().append(jQuery("<div>").addClass("wpcm-results-load-overlay")),this.listings.parent().append((new WPCM_Spinner).getDOM()),jQuery.get(wpcm.ajax_url,c,function(c){b.html(c),b.parent().find(".wpcm-results-load-overlay").remove(),b.parent().find(".wpcm-results-spinner").remove(),a.is_updating=!1})}};var WPCM_Spinner=function(){return this.el=jQuery("<div>").addClass("wpcm-results-spinner").fadeIn(400,WPCM_Spinner.prototype.fadeOut),jQuery(this.el).bind("fade",function(){jQuery(this).fadeOut("slow",function(){jQuery(this).fadeIn("slow",function(){jQuery(this).trigger("fade")})})}),jQuery(this.el).trigger("fade"),this};WPCM_Spinner.prototype.getDOM=function(){return this.el};